<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>–í—ñ–¥–±–∏—Ç–∫–∏ </title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #000; }
        #loader {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 2em;
            z-index: 10;
            text-shadow: 0 0 10px #00ff00;
        }
    </style>
</head>
<body>
    <div id="loader">–ù–∞–≤–µ–¥–∏ –∫–∞–º–µ—Ä—É –Ω–∞ –º–∞—Ä–∫–µ—Ä...</div>

    <a-scene 
        mindar-image="imageTargetSrc: ./my-marker.mind; autoStart: true;" 
        color-space="sRGB" 
        renderer="colorManagement: true, physicallyCorrectLights: true" 
        vr-mode-ui="enabled: false" 
        device-orientation-permission-ui="enabled: false"
        loading-screen="enabled: false">

        <a-assets>
            <img id="left-foot"  src="./footprint1.png" crossorigin="anonymous">
            <img id="right-foot" src="./footprint2.png" crossorigin="anonymous">
            <a-asset-item id="roboto-font" src="https://cdn.aframe.io/fonts/Roboto-msdf.json"></a-asset-item>
        </a-assets>

        <a-entity mindar-image-target="targetIndex: 0" mindar-game-logic id="game-target">
            <a-entity id="ar-game-container" visible="false">
                <!-- 6 —Å–ª—ñ–¥—ñ–≤, –ª–µ–∂–∞—Ç—å –Ω–∞ –ø—ñ–¥–ª–æ–∑—ñ, –∫–æ–∂–µ–Ω –Ω–∞ 30 —Å–º –ø–æ–ø–µ—Ä–µ–¥—É -->
                <a-image id="step1" class="step clickable" width="1.5" height="1.5" rotation="0 0 0" position="0 0 0.02" visible="false" src="#left-foot" material="transparent: true; alphaTest: 0.5; shader: standard; emissive: #00ff00; emissiveIntensity: 0.8;"></a-image>
                <a-image id="step2" class="step clickable" width="1.5" height="1.5" rotation="0 0 0" position="0 0 -0.3" visible="false" src="#right-foot" material="transparent: true; alphaTest: 0.5; shader: standard; emissive: #00ff00; emissiveIntensity: 0.8;"></a-image>
                <a-image id="step3" class="step clickable" width="1.5" height="1.5" rotation="0 0 0" position="0 0 -0.6" visible="false" src="#left-foot" material="transparent: true; alphaTest: 0.5; shader: standard; emissive: #00ff00; emissiveIntensity: 0.8;"></a-image>
                <a-image id="step4" class="step clickable" width="1.5" height="1.5" rotation="0 0 0" position="0 0 -0.9" visible="false" src="#right-foot" material="transparent: true; alphaTest: 0.5; shader: standard; emissive: #00ff00; emissiveIntensity: 0.8;"></a-image>
                <a-image id="step5" class="step clickable" width="1.5" height="1.5" rotation="0 0 0" position="0 0 -1.2" visible="false" src="#left-foot" material="transparent: true; alphaTest: 0.5; shader: standard; emissive: #00ff00; emissiveIntensity: 0.8;"></a-image>
                <a-image id="step6" class="step clickable" width="1.5" height="1.5" rotation="0 0 0" position="0 0 -1.5" visible="false" src="#right-foot" material="transparent: true; alphaTest: 0.5; shader: standard; emissive: #00ff00; emissiveIntensity: 0.8;"></a-image>

                <!-- –ê–Ω—ñ–º–æ–≤–∞–Ω–∏–π —Ç–µ–∫—Å—Ç "–í–Ü–¢–ê–Æ!" -->
                <a-text id="congratulations-text" 
                        value="–í–Ü–¢–ê–Æ!" 
                        position="0 0.3 -0.75" 
                        scale="0.12 0.12 0.12" 
                        rotation="-90 0 0" 
                        visible="false"
                        color="#00ff00" 
                        align="center" 
                        font="#roboto-font" 
                        wrap-count="12"
                        animation__bounce="property: position; to: 0 0.45 -0.75; dur: 800; easing: easeInOutQuad; loop: true; dir: alternate"
                        animation__pulse="property: scale; from: 0.12 0.12 0.12; to: 0.2 0.2 0.2; dur: 1000; easing: easeInOutSine; loop: true; dir: alternate">
                </a-text>
            </a-entity>
        </a-entity>

        <!-- –ö–∞–º–µ—Ä–∞ –∑ –∫—É—Ä—Å–æ—Ä–æ–º + –≤—ñ–∑—É–∞–ª—å–Ω–∏–π –∫—É—Ä—Å–æ—Ä -->
        <a-camera 
            mindar-image-camera 
            cursor="rayOrigin: mouse" 
            raycaster="objects: .clickable; far: 10">
            <!-- –í—ñ–∑—É–∞–ª—å–Ω–∏–π –∫—É—Ä—Å–æ—Ä (–∫—Ä—É–∂–µ—á–æ–∫) -->
            <a-entity 
                cursor="fuse: false; rayOrigin: mouse"
                position="0 0 -1"
                geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                material="color: #00ff00; shader: flat"
                visible="true">
            </a-entity>
        </a-camera>
    </a-scene>

    <script>
        AFRAME.registerComponent('mindar-game-logic', {
            init: function() {
                const target = this.el;
                const container = document.getElementById('ar-game-container');
                const steps = [
                    document.getElementById('step1'),
                    document.getElementById('step2'),
                    document.getElementById('step3'),
                    document.getElementById('step4'),
                    document.getElementById('step5'),
                    document.getElementById('step6')
                ];
                const congratsText = document.getElementById('congratulations-text');
                let gameStarted = false;

                // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–µ–∫—Å—Ç—É—Ä
                ['left-foot', 'right-foot'].forEach(id => {
                    const img = document.getElementById(id);
                    if (img) {
                        img.addEventListener('load', () => console.log(`‚úÖ ${id} –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ`));
                        img.addEventListener('error', () => console.error(`‚ùå ${id} –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ`));
                    }
                });

                // –ú–∞—Ä–∫–µ—Ä –∑–Ω–∞–π–¥–µ–Ω–æ
                target.addEventListener('targetFound', () => {
                    console.log('üü¢ –ú–∞—Ä–∫–µ—Ä –∑–Ω–∞–π–¥–µ–Ω–æ!');
                    document.getElementById('loader').style.display = 'none';
                    container.setAttribute('visible', true);
                    steps[0].setAttribute('visible', true);
                    congratsText.setAttribute('visible', false);
                });

                // –ú–∞—Ä–∫–µ—Ä –≤—Ç—Ä–∞—á–µ–Ω–æ ‚Äî —Ö–æ–≤–∞—î–º–æ –¢–Ü–õ–¨–ö–ò —è–∫—â–æ –≥—Ä–∞ —â–µ –Ω–µ –ø–æ—á–∞–ª–∞—Å—è
                target.addEventListener('targetLost', () => {
                    if (!gameStarted) {
                        console.log('üî¥ –ú–∞—Ä–∫–µ—Ä –≤—Ç—Ä–∞—á–µ–Ω–æ ‚Äî —Ö–æ–≤–∞—î–º–æ —Å–ª—ñ–¥–∏');
                        container.setAttribute('visible', false);
                        steps.forEach(step => step.setAttribute('visible', false));
                        congratsText.setAttribute('visible', false);
                        document.getElementById('loader').style.display = 'block';
                    } else {
                        console.log('üü° –ì—Ä–∞ –≤–∂–µ –ø–æ—á–∞–ª–∞—Å—è ‚Äî —Å–ª—ñ–¥–∏ –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è');
                    }
                });

                // –û–±—Ä–æ–±–∫–∞ –∫–ª—ñ–∫—ñ–≤ –ø–æ —Å–ª—ñ–¥–∞—Ö
                steps.forEach((step, index) => {
                    step.addEventListener('click', () => {
                        console.log(`üë£ –ö–ª—ñ–∫ –ø–æ —Å–ª—ñ–¥—É ${index + 1}`);
                        if (!gameStarted) {
                            gameStarted = true;
                        }
                        step.setAttribute('visible', false);
                        if (index < 5) {
                            steps[index + 1].setAttribute('visible', true);
                        } else {
                            congratsText.setAttribute('visible', true);
                        }
                    });
                });
            }
        });
    </script>
</body>
</html>


