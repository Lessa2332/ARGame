<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>–í—ñ–¥–±–∏—Ç–∫–∏ —Å—Ç–æ–ø ‚Äî –î–∏—Ç—è—á–µ —Å–≤—è—Ç–æ! (–§—ñ–Ω–∞–ª—å–Ω–∞ –≤–µ—Ä—Å—ñ—è)</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #000; }
        #loader {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 1.5em;
            z-index: 10;
            text-shadow: 0 0 10px #00ff00;
        }
    </style>
</head>
<body>
    <div id="loader">–ù–∞–≤–µ–¥—ñ—Ç—å –∫–∞–º–µ—Ä—É –Ω–∞ –º–∞—Ä–∫–µ—Ä —Ç–∞ –Ω–∞—Ç–∏—Å–∫–∞–π—Ç–µ –Ω–∞ —Å–ª—ñ–¥–∏! üë£</div>

    <a-scene 
        mindar-image="imageTargetSrc: ./my-marker.mind; autoStart: true;" 
        color-space="sRGB" 
        renderer="colorManagement: true, physicallyCorrectLights: true" 
        vr-mode-ui="enabled: false" 
        device-orientation-permission-ui="enabled: false"
        loading-screen="enabled: false">

        <a-assets>
            <img id="left-foot"  src="./footprint1.png" crossorigin="anonymous">
            <img id="right-foot" src="./footprint2.png" crossorigin="anonymous">
            <a-asset-item id="roboto-font" src="https://cdn.aframe.io/fonts/Roboto-msdf.json"></a-asset-item>
        </a-assets>

        <a-entity mindar-image-target="targetIndex: 0" mindar-game-logic id="game-target">
            <a-entity id="ar-game-container" visible="false">
                <a-image id="step1" class="step clickable" width="0.6" height="0.6" rotation="-90 0 0" position="0 0.01 0"    visible="false" src="#left-foot"  material="transparent: true; alphaTest: 0.5; shader: standard; emissive: #00ff00; emissiveIntensity: 0.8;"
                         animation__fade="property: material.opacity; from: 1; to: 0; dur: 200; startEvents: click;"></a-image>
                <a-image id="step2" class="step clickable" width="0.6" height="0.6" rotation="-90 0 0" position="0 0.01 -0.7" visible="false" src="#right-foot" material="transparent: true; alphaTest: 0.5; shader: standard; emissive: #00ff00; emissiveIntensity: 0.8;"
                         animation__fade="property: material.opacity; from: 1; to: 0; dur: 200; startEvents: click;"></a-image>
                <a-image id="step3" class="step clickable" width="0.6" height="0.6" rotation="-90 0 0" position="0 0.01 -1.4" visible="false" src="#left-foot"  material="transparent: true; alphaTest: 0.5; shader: standard; emissive: #00ff00; emissiveIntensity: 0.8;"
                         animation__fade="property: material.opacity; from: 1; to: 0; dur: 200; startEvents: click;"></a-image>
                <a-image id="step4" class="step clickable" width="0.6" height="0.6" rotation="-90 0 0" position="0 0.01 -2.1" visible="false" src="#right-foot" material="transparent: true; alphaTest: 0.5; shader: standard; emissive: #00ff00; emissiveIntensity: 0.8;"
                         animation__fade="property: material.opacity; from: 1; to: 0; dur: 200; startEvents: click;"></a-image>
                <a-image id="step5" class="step clickable" width="0.6" height="0.6" rotation="-90 0 0" position="0 0.01 -2.8" visible="false" src="#left-foot"  material="transparent: true; alphaTest: 0.5; shader: standard; emissive: #00ff00; emissiveIntensity: 0.8;"
                         animation__fade="property: material.opacity; from: 1; to: 0; dur: 200; startEvents: click;"></a-image>
                <a-image id="step6" class="step clickable" width="0.6" height="0.6" rotation="-90 0 0" position="0 0.01 -3.5" visible="false" src="#right-foot" material="transparent: true; alphaTest: 0.5; shader: standard; emissive: #00ff00; emissiveIntensity: 0.8;"
                         animation__fade="property: material.opacity; from: 1; to: 0; dur: 200; startEvents: click;"></a-image>

                <a-text id="congratulations-text" 
                        value="–í–Ü–¢–ê–Æ!\n–¢–∏ —Ü–µ –∑—Ä–æ–±–∏–≤!" 
                        position="0 0.35 -2.1" 
                        scale="0.12 0.12 0.12" 
                        rotation="-90 0 0" 
                        visible="false"
                        color="#00ff00" 
                        align="center" 
                        font="#roboto-font" 
                        wrap-count="12"
                        animation__bounce="property: position; to: 0 0.5 -2.1; dur: 800; easing: easeInOutQuad; loop: true; dir: alternate"
                        animation__pulse="property: scale; from: 0.12 0.12 0.12; to: 0.2 0.2 0.2; dur: 1000; easing: easeInOutSine; loop: true; dir: alternate">
                </a-text>
            </a-entity>
        </a-entity>

        <a-camera 
            mindar-image-camera 
            cursor="rayOrigin: mouse" 
            raycaster="objects: .clickable">
        </a-camera>
    </a-scene>

    <script>
        AFRAME.registerComponent('mindar-game-logic', {
            init: function() {
                const target = this.el;
                const container = document.getElementById('ar-game-container');
                const steps = [
                    document.getElementById('step1'),
                    document.getElementById('step2'),
                    document.getElementById('step3'),
                    document.getElementById('step4'),
                    document.getElementById('step5'),
                    document.getElementById('step6')
                ];
                const congratsText = document.getElementById('congratulations-text');
                const FADE_DURATION = 200; // –¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –∞–Ω—ñ–º–∞—Ü—ñ—ó –∑–Ω–∏–∫–Ω–µ–Ω–Ω—è

                // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —Å–∫–∏–¥–∞–Ω–Ω—è –º–∞—Ç–µ—Ä—ñ–∞–ª—É (–ø—Ä–æ–∑–æ—Ä–æ—Å—Ç—ñ) —Å–ª—ñ–¥—É
                const resetStep = (step) => {
                    step.setAttribute('material', 'opacity', 1);
                    step.setAttribute('visible', false);
                };

                target.addEventListener('targetFound', () => {
                    document.getElementById('loader').style.display = 'none';
                    
                    steps.forEach(step => resetStep(step)); 
                    
                    container.setAttribute('visible', true);
                    steps[0].setAttribute('visible', true);
                    congratsText.setAttribute('visible', false);
                    
                    congratsText.setAttribute('animation__bounce', 'property: position; to: 0 0.5 -2.1; dur: 800; easing: easeInOutQuad; loop: true; dir: alternate');
                    congratsText.setAttribute('animation__pulse', 'property: scale; from: 0.12 0.12 0.12; to: 0.2 0.2 0.2; dur: 1000; easing: easeInOutSine; loop: true; dir: alternate');
                });

                target.addEventListener('targetLost', () => {
                    container.setAttribute('visible', false);
                    steps.forEach(step => resetStep(step));
                    congratsText.setAttribute('visible', false);
                    document.getElementById('loader').style.display = 'block';

                    congratsText.removeAttribute('animation__bounce'); 
                    congratsText.removeAttribute('animation__pulse'); 
                });

                // –õ–æ–≥—ñ–∫–∞ –≥—Ä–∏ (–ö–ª—ñ–∫–∏)
                steps.forEach((step, index) => {
                    step.addEventListener('click', () => {
                        // –ö–ª—ñ–∫ –∑–∞–ø—É—Å–∫–∞—î –∞–Ω—ñ–º–∞—Ü—ñ—é –∑–Ω–∏–∫–Ω–µ–Ω–Ω—è (opacity: 1 -> 0)
                        
                        setTimeout(() => {
                            resetStep(step);
                            
                            if (index < 5) {
                                steps[index + 1].setAttribute('visible', true);
                            } else {
                                congratsText.setAttribute('visible', true);
                            }
                        }, FADE_DURATION);
                    });
                });
            }
        });
    </script>
</body>
</html>
