<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Відбитки стоп — Дитяче свято!</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #000; }
        #loader {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 2em;
            z-index: 10;
            text-shadow: 0 0 10px #00ff00;
        }
    </style>
</head>
<body>
    <div id="loader">Наведи камеру на маркер...</div>

    <a-scene 
        mindar-image="imageTargetSrc: ./my-marker.mind; autoStart: true;" 
        color-space="sRGB" 
        renderer="colorManagement: true, physicallyCorrectLights: true" 
        vr-mode-ui="enabled: false" 
        device-orientation-permission-ui="enabled: false"
        loading-screen="enabled: false">

        <a-assets>
            <img id="left-foot"  src="./footprint1.png" crossorigin="anonymous">
            <img id="right-foot" src="./footprint2.png" crossorigin="anonymous">
            <a-asset-item id="roboto-font" src="https://cdn.aframe.io/fonts/Roboto-msdf.json"></a-asset-item>
        </a-assets>

        <a-entity mindar-image-target="targetIndex: 0" mindar-game-logic id="game-target">
            <a-entity id="ar-game-container" visible="false">
                <!-- 6 великих слідів (1.5 м × 1.5 м), кожен на 30 см попереду -->
                <a-image id="step1" class="step clickable" width="1.5" height="1.5" rotation="-90 0 0" position="0 0.02 0"    visible="false" src="#left-foot"  material="transparent: true; alphaTest: 0.5; shader: standard; emissive: #00ff00; emissiveIntensity: 0.8;"></a-image>
                <a-image id="step2" class="step clickable" width="1.5" height="1.5" rotation="-90 0 0" position="0 0.02 -0.3" visible="false" src="#right-foot" material="transparent: true; alphaTest: 0.5; shader: standard; emissive: #00ff00; emissiveIntensity: 0.8;"></a-image>
                <a-image id="step3" class="step clickable" width="1.5" height="1.5" rotation="-90 0 0" position="0 0.02 -0.6" visible="false" src="#left-foot"  material="transparent: true; alphaTest: 0.5; shader: standard; emissive: #00ff00; emissiveIntensity: 0.8;"></a-image>
                <a-image id="step4" class="step clickable" width="1.5" height="1.5" rotation="-90 0 0" position="0 0.02 -0.9" visible="false" src="#right-foot" material="transparent: true; alphaTest: 0.5; shader: standard; emissive: #00ff00; emissiveIntensity: 0.8;"></a-image>
                <a-image id="step5" class="step clickable" width="1.5" height="1.5" rotation="-90 0 0" position="0 0.02 -1.2" visible="false" src="#left-foot"  material="transparent: true; alphaTest: 0.5; shader: standard; emissive: #00ff00; emissiveIntensity: 0.8;"></a-image>
                <a-image id="step6" class="step clickable" width="1.5" height="1.5" rotation="-90 0 0" position="0 0.02 -1.5" visible="false" src="#right-foot" material="transparent: true; alphaTest: 0.5; shader: standard; emissive: #00ff00; emissiveIntensity: 0.8;"></a-image>

                <!-- Анімований текст "ВІТАЮ!" -->
                <a-text id="congratulations-text" 
                        value="ВІТАЮ!" 
                        position="0 0.3 -0.75" 
                        scale="0.12 0.12 0.12" 
                        rotation="-90 0 0" 
                        visible="false"
                        color="#00ff00" 
                        align="center" 
                        font="#roboto-font" 
                        wrap-count="12"
                        animation__bounce="property: position; to: 0 0.45 -0.75; dur: 800; easing: easeInOutQuad; loop: true; dir: alternate"
                        animation__pulse="property: scale; from: 0.12 0.12 0.12; to: 0.2 0.2 0.2; dur: 1000; easing: easeInOutSine; loop: true; dir: alternate">
                </a-text>
            </a-entity>
        </a-entity>

        <!-- Курсор для кліків -->
        <a-camera 
            mindar-image-camera 
            cursor="rayOrigin: mouse" 
            raycaster="objects: .clickable">
        </a-camera>
    </a-scene>

    <script>
        AFRAME.registerComponent('mindar-game-logic', {
            init: function() {
                const target = this.el;
                const container = document.getElementById('ar-game-container');
                const steps = [
                    document.getElementById('step1'),
                    document.getElementById('step2'),
                    document.getElementById('step3'),
                    document.getElementById('step4'),
                    document.getElementById('step5'),
                    document.getElementById('step6')
                ];
                const congratsText = document.getElementById('congratulations-text');
                let gameStarted = false;

                // Завантаження текстур
                ['left-foot', 'right-foot'].forEach(id => {
                    const img = document.getElementById(id);
                    if (img) {
                        img.addEventListener('load', () => console.log(`✅ ${id} завантажено`));
                        img.addEventListener('error', () => console.error(`❌ ${id} не знайдено`));
                    }
                });

                // Маркер знайдено
                target.addEventListener('targetFound', () => {
                    document.getElementById('loader').style.display = 'none';
                    container.setAttribute('visible', true);
                    steps[0].setAttribute('visible', true);
                    congratsText.setAttribute('visible', false);
                });

                // Маркер втрачено — ховаємо ТІЛЬКИ якщо гра ще не почалася
                target.addEventListener('targetLost', () => {
                    if (!gameStarted) {
                        container.setAttribute('visible', false);
                        steps.forEach(step => step.setAttribute('visible', false));
                        congratsText.setAttribute('visible', false);
                        document.getElementById('loader').style.display = 'block';
                    }
                });

                // Обробка кліків
                steps.forEach((step, index) => {
                    step.addEventListener('click', () => {
                        if (!gameStarted) {
                            gameStarted = true;
                        }
                        step.setAttribute('visible', false);
                        if (index < 5) {
                            steps[index + 1].setAttribute('visible', true);
                        } else {
                            congratsText.setAttribute('visible', true);
                        }
                    });
                });
            }
        });
    </script>
</body>
</html>
