<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>MindAR Game: Neon Green Footprints</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mindar-image-aframe@1.2.0/dist/mindar-image-aframe.prod.js"></script>
    <style>
        body { margin: 0; overflow: hidden; }
    </style>
</head>
<body>

<a-scene 
    mindar-image="imageTargetSrc: ./my-marker.mind; autoStart: true;" 
    color-space="sRGB" 
    renderer="colorManagement: true, physicallyCorrectLights: true" 
    vr-mode-ui="enabled: false" 
    device-orientation-permission-ui="enabled: false">
    
    <a-assets>
        <img id="footprint1-texture" src="./footprint.png">
        <img id="footprint2-texture" src="./footprint1.png">
    </a-assets>

    <a-entity mindar-image-target="targetIndex: 0" id="game-target">
        
        <a-entity id="ar-game-container" visible="false">
            <a-plane id="step1" class="step" width="0.1" height="0.1" rotation="-90 0 0" position="0 0.001 -0.15" visible="false"
                     material="src: #footprint1-texture; transparent: true; emissive: #00ff00; emissiveIntensity: 0.8;"></a-plane>
            <a-plane id="step2" class="step" width="0.1" height="0.1" rotation="-90 0 0" position="0 0.001 -0.30" visible="false"
                     material="src: #footprint2-texture; transparent: true; emissive: #00ff00; emissiveIntensity: 0.8;"></a-plane>
            <a-plane id="step3" class="step" width="0.1" height="0.1" rotation="-90 0 0" position="0 0.001 -0.45" visible="false"
                     material="src: #footprint1-texture; transparent: true; emissive: #00ff00; emissiveIntensity: 0.8;"></a-plane>
            
            <a-text id="congratulations-text" value="Вітаю!" position="0 0.05 -0.60" scale="0.1 0.1 0.1" rotation="-90 0 0" visible="false"
                    color="#00ff00" align="center" font="dejavu"></a-text>
        </a-entity>
    </a-entity>

    <a-entity camera mindar-image-camera></a-entity>

</a-scene>

<script>
    // КОМПОНЕНТ ЛОГІКИ ГРИ (АДАПТОВАНИЙ ПІД ПОДІЇ MINDAR)
    AFRAME.registerComponent('mindar-game-logic', {
        init: function() {
            const target = this.el; // <a-entity mindar-image-target>
            const container = document.getElementById('ar-game-container');
            const steps = [
                document.getElementById('step1'),
                document.getElementById('step2'),
                document.getElementById('step3')
            ];
            const congratsText = document.getElementById('congratulations-text');
            
            let stepIndex = 0;
            let stepInterval;
            
            // MindAR використовує події targetFound
            target.addEventListener('targetFound', function() {
                console.log('Ціль знайдено!');
                container.setAttribute('visible', 'true');
                stepIndex = 0;
                steps.forEach(step => step.setAttribute('visible', 'false'));
                congratsText.setAttribute('visible', 'false');

                // Запускаємо анімацію появи слідів (1.5 секунди між кроками)
                stepInterval = setInterval(() => {
                    if (stepIndex < steps.length) {
                        steps[stepIndex].setAttribute('visible', 'true');
                        stepIndex++;
                    } else {
                        clearInterval(stepInterval);
                        congratsText.setAttribute('visible', 'true');
                    }
                }, 1500); 
            });

            target.addEventListener('targetLost', function() {
                console.log('Ціль втрачено!');
                clearInterval(stepInterval);
                container.setAttribute('visible', 'false');
                steps.forEach(step => step.setAttribute('visible', 'false'));
                congratsText.setAttribute('visible', 'false');
            });
        }
    });

    // Застосовуємо компонент до MindAR-цілі
    document.querySelector('[mindar-image-target]').setAttribute('mindar-game-logic', '');
</script>
</body>
</html>
