<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>MindAR Game: Neon Green Footprints (–û–Ω–æ–≤–ª–µ–Ω–æ)</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; }
        #loader {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 2em;
            z-index: 10;
        }
    </style>
</head>
<body>
    <div id="loader">–ù–∞–≤–µ–¥–∏ –∫–∞–º–µ—Ä—É –Ω–∞ –º–∞—Ä–∫–µ—Ä...</div>

    <a-scene 
        mindar-image="imageTargetSrc: ./my-marker.mind; autoStart: true;" 
        color-space="sRGB" 
        renderer="colorManagement: true, physicallyCorrectLights: true" 
        vr-mode-ui="enabled: false" 
        device-orientation-permission-ui="enabled: false"
        loading-screen="enabled: false">
        <a-assets>
            <a-asset-item id="roboto-font" src="https://cdn.aframe.io/fonts/Roboto-msdf.json"></a-asset-item>
        </a-assets>

        <a-entity mindar-image-target="targetIndex: 0" mindar-game-logic id="game-target">
            <a-entity id="ar-game-container" visible="false">
                <a-cone id="step1" class="step" radius-bottom="0.1" height="0.2" rotation="0 0 0" position="0 0.1 0" visible="false"
                        material="color: #00ff00; shader: standard; emissive: #00ff00; emissiveIntensity: 0.8;"></a-cone>
                <a-cone id="step2" class="step" radius-bottom="0.1" height="0.2" rotation="0 0 0" position="0 0.1 -0.15" visible="false"
                        material="color: #00ff00; shader: standard; emissive: #00ff00; emissiveIntensity: 0.8;"></a-cone>
                <a-cone id="step3" class="step" radius-bottom="0.1" height="0.2" rotation="0 0 0" position="0 0.1 -0.30" visible="false"
                        material="color: #00ff00; shader: standard; emissive: #00ff00; emissiveIntensity: 0.8;"></a-cone>
                
                <a-text id="congratulations-text" value="–í–Ü–¢–ê–Æ!" position="0 0.2 -0.45" scale="0.1 0.1 0.1" rotation="-90 0 0" visible="false"
                        color="#00ff00" align="center" font="#roboto-font" wrap-count="20"
                        animation="property: scale; to: 0.15 0.15 0.15; dir: alternate; loop: true; dur: 800; startEvents: animate-congrats;"></a-text>
            </a-entity>
        </a-entity>

        <a-camera mindar-image-camera></a-camera>
    </a-scene>

    <script>
        AFRAME.registerComponent('mindar-game-logic', {
            init: function() {
                const target = this.el;
                const container = document.getElementById('ar-game-container');
                const steps = [
                    document.getElementById('step1'),
                    document.getElementById('step2'),
                    document.getElementById('step3')
                ];
                const congratsText = document.getElementById('congratulations-text');
                const STEP_DELAY = 1000;

                let timeoutRef;

                const showNextStep = (index) => {
                    if (!container.getAttribute('visible')) return;

                    if (index < steps.length) {
                        steps[index].setAttribute('visible', true);
                        timeoutRef = setTimeout(() => {
                            showNextStep(index + 1);
                        }, STEP_DELAY);
                    } else {
                        congratsText.setAttribute('visible', true);
                        congratsText.emit('animate-congrats');
                    }
                };

                target.addEventListener('targetFound', () => {
                    console.log('–¶—ñ–ª—å –∑–Ω–∞–π–¥–µ–Ω–æ! üü¢', target);
                    document.getElementById('loader').style.display = 'none';
                    clearTimeout(timeoutRef);
                    container.setAttribute('visible', true);
                    steps.forEach(step => step.setAttribute('visible', false));
                    congratsText.setAttribute('visible', false);
                    showNextStep(0);
                });

                target.addEventListener('targetLost', () => {
                    console.log('–¶—ñ–ª—å –≤—Ç—Ä–∞—á–µ–Ω–æ! üî¥', target);
                    clearTimeout(timeoutRef);
                    container.setAttribute('visible', false);
                    steps.forEach(step => step.setAttribute('visible', false));
                    congratsText.setAttribute('visible', false);
                    document.getElementById('loader').style.display = 'block';
                });
            }
        });
    </script>
</body>
</html>
