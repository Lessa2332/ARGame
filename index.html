<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>MindAR Game: Neon Green Footprints (–û–Ω–æ–≤–ª–µ–Ω–æ)</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mindar-image-aframe@1.2.0/dist/mindar-image-aframe.prod.js"></script>
    <style>
        body { margin: 0; overflow: hidden; }
    </style>
</head>
<body>

<a-scene 
    mindar-image="imageTargetSrc: ./my-marker.mind; autoStart: true;" 
    color-space="sRGB" 
    renderer="colorManagement: true, physicallyCorrectLights: true" 
    vr-mode-ui="enabled: false" 
    device-orientation-permission-ui="enabled: false"
    loading-screen="enabled: false"> <a-assets>
        <img id="footprint1-texture" src="./footprint.png" crossorigin="anonymous">
        <img id="footprint2-texture" src="./footprint1.png" crossorigin="anonymous">
        
        <a-asset-item id="roboto-font" src="https://cdn.aframe.io/fonts/Roboto-msdf.json"></a-asset-item>
    </a-assets>

    <a-entity mindar-image-target="targetIndex: 0" mindar-game-logic id="game-target">
        <a-entity id="ar-game-container" visible="false">
            <a-plane id="step1" class="step" width="0.1" height="0.1" rotation="-90 0 0" position="0 0.001 -0.15" visible="false"
                     material="src: #footprint1-texture; transparent: true; shader: standard; emissive: #00ff00; emissiveIntensity: 0.8;"></a-plane>
            <a-plane id="step2" class="step" width="0.1" height="0.1" rotation="-90 0 0" position="0 0.001 -0.30" visible="false"
                     material="src: #footprint2-texture; transparent: true; shader: standard; emissive: #00ff00; emissiveIntensity: 0.8;"></a-plane>
            <a-plane id="step3" class="step" width="0.1" height="0.1" rotation="-90 0 0" position="0 0.001 -0.45" visible="false"
                     material="src: #footprint1-texture; transparent: true; shader: standard; emissive: #00ff00; emissiveIntensity: 0.8;"></a-plane>
            
            <a-text id="congratulations-text" value="–í–Ü–¢–ê–Æ!" position="0 0.05 -0.60" scale="0.1 0.1 0.1" rotation="-90 0 0" visible="false"
                    color="#00ff00" align="center" font="#roboto-font" wrap-count="20"
                    animation="property: scale; to: 0.15 0.15 0.15; dir: alternate; loop: true; dur: 800; startEvents: animate-congrats;"></a-text>
        </a-entity>
    </a-entity>

    <a-entity camera mindar-image-camera></a-entity>

</a-scene>

<script>
    AFRAME.registerComponent('mindar-game-logic', {
        init: function() {
            const target = this.el;
            const container = document.getElementById('ar-game-container');
            const steps = [
                document.getElementById('step1'),
                document.getElementById('step2'),
                document.getElementById('step3')
            ];
            const congratsText = document.getElementById('congratulations-text');
            const STEP_DELAY = 1000; // –ß–∞—Å –º—ñ–∂ –ø–æ—è–≤–æ—é –∫—Ä–æ–∫—ñ–≤ (1 —Å–µ–∫—É–Ω–¥–∞)
            
            let timeoutRef; // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–∏–π —Ç–∞–π–º–∞—É—Ç

            /**
             * –†–µ–∫—É—Ä—Å–∏–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ–≥–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∫—Ä–æ–∫—ñ–≤.
             * –¶–µ –∫—Ä–∞—â–µ, –Ω—ñ–∂ setInterval, –æ—Å–∫—ñ–ª—å–∫–∏ –∑–∞–±–µ–∑–ø–µ—á—É—î –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—é.
             */
            const showNextStep = (index) => {
                // –ó–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –ø–æ–∫–∞–∑—É, —è–∫—â–æ –º–∞—Ä–∫–µ—Ä –≤—Ç—Ä–∞—á–µ–Ω–æ
                if (!container.getAttribute('visible')) return; 

                if (index < steps.length) {
                    // –ü–æ–∫–∞–∑—É—î–º–æ –ø–æ—Ç–æ—á–Ω–∏–π –∫—Ä–æ–∫
                    steps[index].setAttribute('visible', true); 
                    
                    // –ü–ª–∞–Ω—É—î–º–æ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –∫—Ä–æ–∫
                    timeoutRef = setTimeout(() => {
                        showNextStep(index + 1);
                    }, STEP_DELAY);
                } else {
                    // –£—Å—ñ –∫—Ä–æ–∫–∏ –ø–æ–∫–∞–∑–∞–Ω–æ: –ø–æ–∫–∞–∑—É—î–º–æ —Ç–µ–∫—Å—Ç —ñ –∑–∞–ø—É—Å–∫–∞—î–º–æ –π–æ–≥–æ –∞–Ω—ñ–º–∞—Ü—ñ—é
                    congratsText.setAttribute('visible', true);
                    congratsText.emit('animate-congrats');
                }
            };

            target.addEventListener('targetFound', () => {
                console.log('–¶—ñ–ª—å –∑–Ω–∞–π–¥–µ–Ω–æ! üü¢');
                
                // –û—á–∏—â–∞—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —Ç–∞–π–º–∞—É—Ç –Ω–∞ –≤–∏–ø–∞–¥–æ–∫ —à–≤–∏–¥–∫–æ–≥–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏—è–≤–ª–µ–Ω–Ω—è
                clearTimeout(timeoutRef); 
                
                // –°–∫–∏–¥–∞—î–º–æ —Å—Ç–∞–Ω —Å—Ü–µ–Ω–∏
                container.setAttribute('visible', true);
                steps.forEach(step => step.setAttribute('visible', false));
                congratsText.setAttribute('visible', false);

                // –ü–æ—á–∏–Ω–∞—î–º–æ –≥—Ä—É –∑ –ø–µ—Ä—à–æ–≥–æ –∫—Ä–æ–∫—É
                showNextStep(0);
            });

            target.addEventListener('targetLost', () => {
                console.log('–¶—ñ–ª—å –≤—Ç—Ä–∞—á–µ–Ω–æ! üî¥');
                
                // –û—á–∏—â–∞—î–º–æ –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–∏–π —Ç–∞–π–º–∞—É—Ç, –∑—É–ø–∏–Ω—è—é—á–∏ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å
                clearTimeout(timeoutRef); 
                
                // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ –≤—Å—ñ –µ–ª–µ–º–µ–Ω—Ç–∏
                container.setAttribute('visible', false);
                steps.forEach(step => step.setAttribute('visible', false));
                congratsText.setAttribute('visible', false);
            });
        }
    });
</script>
</body>
</html>
